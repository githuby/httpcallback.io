box: pjvds/golang
build:
  steps:
    - script:
        name: Enable package caching
        code: |-
          export GO_PKG_CACHE_DIR=$WERCKER_CACHE_DIR/go-pkg-cache
          mkdir -p $GO_PKG_CACHE_DIR
          rm -fr "$GOPATH"
          ln -s $GO_PKG_CACHE_DIR/ "$GOPATH"
    - pjvds/setup-go-workspace
    - script:
        name: Populate cache
        code: |-
            if test -d "$WERCKER_CACHE_DIR/go-pkg-cache"; then rsync -avz --exclude "$WERCKER_SOURCE_DIR" "$WERCKER_CACHE_DIR/go-pkg-cache" "$GOPATH" ; fi
    - script:
        name: Get dependencies
        code: go get -v ./...
    - script:
        name: Build
        code: |
          go build -v
    - script:
        name: Test
        code: go test ./...
    - script:
        name: Store cache
        code: |-
            rsync -avz --exclude "$WERCKER_SOURCE_DIR" "$GOPATH" "$WERCKER_CACHE_DIR/go-pkg-cache"
