box: wercker/golang
# Build definition
build:
  # The steps that will be executed on build
  steps:
    - install-packages:
        packages: bzr git mercurial
    - script:
        name: setup golang
        code: |
          mkdir $HOME/mygo
          export GOPATH="$HOME/mygo"
          export PATH=$PATH:$GOPATH/bin
          mkdir $GOPATH/bin
          mkdir $GOPATH/pkg

          org="$WERCKER_SOURCE_DIR"
          export WERCKER_SOURCE_DIR="$GOPATH/src/github.com/pjvds/httpcallback.io"
          mkdir -p "$WERCKER_SOURCE_DIR"

          #sudo cp -R "$org/" "$WERCKER_SOURCE_DIR"
          git clone "https://github.com/pjvds/httpcallback.io.git" "$WERCKER_SOURCE_DIR"
          sudo rm -rf "$org/"
    - script:
        name: go get
        code: |
          cd $WERCKER_SOURCE_DIR
          go version
          go get ./...
    - script:
        name: go build
        code: |
          go build .
    - script:
        name: go test
        code: |
          echo "127.0.0.1       api.localhost" | sudo tee "/etc/hosts"
          go test ./...
